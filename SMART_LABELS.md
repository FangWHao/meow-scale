# 智能横轴标签显示策略 - 详细说明

## 📊 显示规则

横轴日期标签会根据数据点的数量自动调整显示密度，确保图表清晰易读。

### 规则表格

| 数据点数量 | 显示间隔 | 示例 |
|-----------|---------|------|
| ≤ 7个 | 全部显示 | 12-01, 12-02, 12-03, 12-04, 12-05, 12-06, 12-07 |
| 8-10个 | 每2个显示 | 12-01, 12-03, 12-05, 12-07, 12-09, 12-10 |
| 11-15个 | 每3个显示 | 12-01, 12-04, 12-07, 12-10, 12-13, 12-15 |
| 16-30个 | 每5个显示 | 12-01, 12-06, 12-11, 12-16, 12-21, 12-26, 12-30 |
| 31-60个 | 每7个显示 | 12-01, 12-08, 12-15, 12-22, 12-29, 01-05, 01-12 |
| > 60个 | 每15个显示 | 11-01, 11-16, 12-01, 12-16, 01-01, 01-16, 02-01 |

### 特殊规则

1. **首尾必显**：无论数据量多少，第一个和最后一个日期标签总是会显示
2. **自动旋转**：当标签较多时，会自动旋转0-45度以节省空间
3. **自动跳过**：Chart.js 还会根据实际渲染空间进一步优化标签显示

## 🎯 设计目的

### 为什么需要智能标签？

1. **避免拥挤**：如果有100天的数据，显示所有日期会导致标签重叠
2. **保持可读性**：确保用户能清楚看到每个显示的日期
3. **关键信息优先**：始终显示起始和结束日期，让用户知道时间范围

## 💡 实际场景示例

### 场景 1: 新用户（5天数据）
```
显示: 12-19, 12-20, 12-21, 12-22, 12-23
结果: 所有日期都显示，非常清晰
```

### 场景 2: 活跃用户（30天数据）
```
显示: 11-24, 11-29, 12-04, 12-09, 12-14, 12-19, 12-23
结果: 每5天显示一个，保持清晰
```

### 场景 3: 长期用户（90天数据）
```
显示: 09-25, 10-02, 10-09, 10-16, 10-23, 10-30, 11-06, 11-13, 11-20, 11-27, 12-04, 12-11, 12-18, 12-23
结果: 每7天显示一个，覆盖整个时间范围
```

### 场景 4: 超长期用户（180天数据）
```
显示: 06-27, 07-12, 07-27, 08-11, 08-26, 09-10, 09-25, 10-10, 10-25, 11-09, 11-24, 12-09, 12-23
结果: 每15天显示一个，保持图表整洁
```

## 🔧 技术实现

在 `HistoryChart.jsx` 中的 `options.scales.x.ticks.callback` 函数：

```javascript
callback: function(value, index, ticks) {
    const totalLabels = allDates.length;
    let skipInterval = 1;
    
    // 根据数据量确定间隔
    if (totalLabels > 60) skipInterval = 15;
    else if (totalLabels > 30) skipInterval = 7;
    else if (totalLabels > 15) skipInterval = 5;
    else if (totalLabels > 10) skipInterval = 3;
    else if (totalLabels > 7) skipInterval = 2;
    
    // 首尾必显
    if (index === 0 || index === totalLabels - 1) {
        return allDates[index];
    }
    
    // 按间隔显示
    if (index % skipInterval === 0) {
        return allDates[index];
    }
    
    return ''; // 隐藏此标签
}
```

## 🎨 配合其他功能

智能标签显示与其他功能完美配合：

1. **时间范围过滤**：选择"最近30天"后，标签会自动调整为合适的间隔
2. **横向滚动**：即使图表可以滚动，标签也不会过于密集
3. **响应式设计**：在手机和电脑上都能保持良好的可读性

## 📱 移动端优化

- 标签旋转角度会根据屏幕宽度自动调整
- 触摸滚动时，标签始终保持清晰
- 小屏幕上会显示更少的标签，避免拥挤

## 🚀 未来可能的改进

- [ ] 根据屏幕宽度动态调整间隔
- [ ] 支持用户自定义标签显示密度
- [ ] 在鼠标悬停时显示完整日期
- [ ] 添加"显示所有标签"的切换选项
